<!DOCTYPE html>
<html>

<head>
    <title>Pico JS</title>
    <!-- <script src="./build/picojs.umd.js"></script> -->
<script type="module">
import Pico from "./src/pico";
import PicoService from "./src/picoservices";
window.appservice = new PicoService({
    protocol: "http",
    domain: "localhost:3000",
    call_oninit: ["/api/todos"],
    headerMap: {"/api/todos": {method: "GET"} },
    endpoints: [["/api/todos", (res, state)=> { state.todos = res.data; }]]
}).loadApps([new Pico({
    name: "PicoJs Service demo",
    root: document.getElementById('app'),
    receive(id, newdata, state){
        console.log('do something', state, newdata)
        state.todos = [...state.todos, ...newdata.todos]
    },
    beforemount: (state)=>{
        console.log('before we mount our nodes...')
    },
    actions: {
        increment: (state) => {
            state.count += 1;
        },
        decrement: (state) => {
            state.count -= 1;
        },
        addtodo( state ){ 
            if(!state.todo || (event.key !== 'Enter' && event.type !== 'click')){return;}
            state.todos = [...state.todos, state.todo]
            state.todo = '';
        },
        handleMousemove(state, event) {
            const m = {x: event.clientX,y: event.clientY};
            state.mouse = m;
        },
        markdone(state){
            console.log(event.target)
        }
    },
    state: {
        count: 0,
        items: ["one","two","three"],
        todos: ["pico","means very small"],
        todo: '',
        mouse: {x: 0, y: 0}
    },
    view: (state) => { 
        return `
        <style>
            .red{color: red;}
            .green{color: green;}
            .strike{text-decoration: line-through}
            .todolist{background: aliceblue; padding: 1rem;}
            #app{margin: 0 auto; padding:2rem; max-width: 500px;}
        </style>
        this is only a test
        <div class="todolist" onclick="foo"></div>
        <ul class="dyn-list menu" data-for="thing in todos">
            <li class="menu-item">
                <label class="{'form-checkbox'+ (thing==='pico' ? ' strike':'')}" data-foo="{thing==='pico' ? 'checked':'unchecked'}">
                    <input type="checkbox" value="{thing}" checked="{thing==='pico' ? 'checked':'unchecked'}">
                    <i class="form-icon"></i> {thing} : {thing.length}
                </label>
            </li>
            ---
        </ul>
        <h2 class="{state.todos.length % 2===0 ? 'green': 'red'}">Todos: {state.todos.length}</h2>
        <div class="form-group">
            <label class="form-label">Name</label>
            <input data-bind:value="state.todo" onkeypress="addtodo" class="form-input" type="text" placeholder="Press enter key to submit a todo"/>
            <p class="form-input-hint"><strong>{state.todo} : {state.todo.length}</strong></p>
        </div>
        <div class="btn-group btn-group-block">
            <button onclick="increment" class="btn btn-primary">+{state.count}</button>
            <button class="btn">Fetch Todos</button>
            <button onclick="decrement" class="btn">-</button>
            </div>
        `
    }
})]);
</script>
</head>

<body>
    <h1>Pico JS Sandbox</h1>
    <div id="app"></div>
</body>

</html>