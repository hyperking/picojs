<!DOCTYPE html>
<html>

<head>
    <title>PicoJS</title>
    <link rel="stylesheet" href="/style.css">
    <!-- <script src="./build/picojs.umd.js.br"></script> 
    new PicoServices({
        protocol: "http",
        domain: "localhost:3000",
        call_oninit: ["/api/todos"],
        headerMap: {"/api/todos": {method: "GET"} },
        endpoints: [["/api/todos", (res, state)=> { state.todos = res.data; }]]
    }).loadApps([
    -->
<script type="module">
    import Pico from "./src/pico";
    import PicoServices from "./src/picoservices";
    window.app = 
    new Pico({
        name: "Pico Service demo",
        root: document.getElementById('app'),
        receive(id, newdata, state){
            state.todos = [...state.todos, ...newdata.todos ] //appends to existing list * recommended
        },
        beforemount: (state)=>{
            console.log('before we mount our nodes...')
            state.tablecolumns = ['done', 'id', 'name' ];
        },
        actions: {

            increment: (state) => {
                console.log('inc')
                state.likes += 1;
            },
            decrement: (state) => {
                state.likes -= 1;
            },
            addtodo( state ){ 
                state.todo = event.target.value;
                if(!state.todo || (event.key !== 'Enter' && event.type !== 'click')){return;}
                state.todos = [...state.todos, {name: state.todo, done: false, id: state.todos.length}]
                state.todo = ''
            },
            handleMousemove(state, event) {
                const m = {x: event.clientX,y: event.clientY};
                state.mouse = m;
            },
            shuffleColumns(state){
                state.tablecolumns = ['name','id','done']
            },
            appendTodos(state){
                state.todos = [...state.todos, {done: true, id: state.todos.length, name: `foo ${state.todos.length}`}] //appends to existing list * recommended
            },
            prependTodos(state){
                state.todos = [{name: `foo ${state.todos.length}`, done: true, id: state.todos.length}, ...state.todos] //prepends to existing list
            },
            sortby(state){
                let key = event.target.dataset.sortby;
                state.sortcolumns = {[key]: !state.sortcolumns[key]};
                const dsc_order = state.sortcolumns[key];
                function normalize(value){
                    return typeof value === 'string' ? value.toLowerCase() : value;
                }
                const stodos = state.todos.sort((cursor, next_cursor) => (normalize(cursor[key]) > normalize(next_cursor[key])) ?  (dsc_order ? 1 : -1) : (dsc_order ? -1 : 1));
                state.todos = [...stodos];
            },
            markDone(state){
                const i = event.target.id;
                console.log(i, event.target)
            },
            showMeter(state){
                console.log(event.target)
                state.showMeter = !state.showMeter;
            },
            setFilter(state){
                state.filterFor = event.target.value;
            }
        },
        state: {
            showMeter: false,
            $:{//Computed properties are named functions that return values which are set to state during update
                filteredTodos: (state) => {
                    //if(state.filterFor===""){return state.todos;}
                    const search_filter = state.filterFor;
                    const filterTodos = state.todos.filter((entry) => JSON.stringify(Object.values(entry)).toLowerCase().includes(search_filter.toLowerCase()) );
                    return filterTodos;
                },
                character: (state)=> 'https://raw.githubusercontent.com/msikma/pokesprite/master'+(
                (state.likes > 15) ? '/pokemon-gen8/regular/charizard-gmax.png' : 
                (state.likes > 10) ? '/pokemon-gen8/regular/venusaur-gmax.png' : 
                (state.likes > 5) ? '/pokemon-gen8/shiny/venusaur.png' : 
                (state.likes >= 3)? '/pokemon-gen7x/shiny/venusaur.png':'/items/evo-item/thunder-stone.png')
            },
            filterFor: '',
            sortcolumns: {},
            likes: 0,
            items: ["one","two","three"],
            todos: [{done: false,id:0, name: "pico sm"},{done: false,id:1, name: "means very small"}],
            todo: '',
            mouse: {x: 0, y: 0}
        },
        view: document.getElementById('app-template')
        })
        //]);
</script>

</head>

<body>
    <template id="app-templatez">
        <table class="table table-striped table-hover" onmousemove="handleMousemove">
            <thead>
              <tr data-for="key in tablecolumns">
                <th>{key}</th>
              </tr>
            </thead>
            <tbody data-for="thing in todos">
              <tr data-for="col in tablecolumns">
                <td>{thing[col]}</td>
              </tr>
            </tbody>
          </table>
    </template>
    <template id="app-templated">
        <style>.todolist{padding:1rem; background-color: aliceblue;}</style>
        <div class="todolist">
            <ol class="dyn-list menu" data-for="thing in todos">
                <li class="menu-item" id="{loop.index}" >
                    {thing.name} - {state.likes} 
                    <button onclick="markDone" id="{loop.index}">mark as done</button>
                </li>
            </ol></div>
        </template>
    <template id="app-template">
        <style>
            ol{list-style: decimal outside;}
            .red{color: red;}
            .green{color: green;}
            .strike{text-decoration: line-through}
            .todolist{background: aliceblue; padding: 1rem;}
            span.highlight { background: aqua; }
            #app{margin: 0 auto; padding:2rem; max-width: 700px;}
        </style>
        Fun times, improving, exploring, and developing features
        <!-- <TestComponent></TestComponent> -->
        <!-- <h2 class="{state.todos.length % 2===0 ? 'green': 'red'}">Todos: {state.todos.length}</h2>
        <p>Likes: {state.likes}, Sorting by: {JSON.stringify(state.sortcolumns)}</p>
        <div class="form-group">
            <label class="form-label">Name</label>
            <input value="{state.todo}" onkeypress="addtodo" class="form-input" type="text" placeholder="Press enter key to submit a todo"/>
            <p><strong>{state.todo} : {state.todo.length}</strong></p>
        </div>
        <div class="btn-group btn-group-block">
            <button onclick="prependTodos" class="btn">Prepend Todos <span>{state.likes}</span></button>
            <button onclick="appendTodos" class="btn">Append Todos <span>{state.likes}</span></button>
            <button onclick="shuffleColumns" class="btn">Shuffle Columns<span>{state.likes}</span></button>
        </div>
        <div class="btn-group btn-group-block">
            <button onclick="increment" class="btn btn-primary">+Likes</button>
            <button onclick="markDone" class="btn btn-primary">Show Meter</button>
            <button onclick="decrement" class="btn btn-primary">-Dislikes</button>
        </div> -->
        <!-- <div class="todolist" onmousemove="handleMousemove">
        <ol class="dyn-list menu" data-for="thing in todos">
            <li class="menu-item">
                <label class="form-checkbox">
                    {thing.name} - {state.likes} 
                    <button onclick="markDone">done {loop.index}</button>
                </label>
            </li>
        </ol></div> -->
        <div class="character">
            <span>x:{state.mouse.x} y: {state.mouse.y}</span>
            <!-- <img class="img-responsive col-2" src={state.character} style="margin: 0 auto;"/> -->
            <div class="table-search"><label for="table-search">Search</label>
                <input oninput="setFilter" id="table-search" class="form-input" type="text" placeholder="searching by ...">
            </div>
        </div>
        <table class="table table-striped table-hover" onmousemove="handleMousemove">
            <thead>
              <tr data-for="tcol in tablecolumns">
                <th>{tcol}<button onclick="sortby" data-sortby="{tcol}">^</button></th>
              </tr>
            </thead>
            <tbody data-for="thing in filteredTodos">
              <tr data-for="col in tablecolumns">
                <td>{@html col==='id' ? outerloop.index+1 : highlight(thing[col])} 
                    <!-- <ul data-for="item in items"><li>{item} , {loop.index}</li></ul> -->
                </td>
              </tr>
            </tbody>
        </table>
    </template>
    <div id="app"><h3 style="margin: 0 auto; width: 120px; padding: 2rem 0; color: deeppink; letter-spacing: -1px;">pico<small>.js</small></h3></div>
</body>

</html>