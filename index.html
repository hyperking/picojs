<!DOCTYPE html>
<html>

<head>
    <title>kunaiJS</title>
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
<link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">
    <!-- <script src="./build/kunaijs.umd.js"></script> -->
<script type="module">
    import Kunai from "./src/kunai";
    import KunaiService from "./src/kunaiservices";

    window.app = new KunaiService({
        protocol: "http",
        domain: "localhost:3000",
        call_oninit: ["/api/todos"],
        headerMap: {"/api/todos": {method: "GET"} },
        endpoints: [["/api/todos", (res, state)=> { state.todos = res.data; }]]
    }).loadApps([
    new Kunai({
        name: "PicoJs Service demo",
        root: document.getElementById('app'),
        receive(id, newdata, state){
            //state.tablecolumns = Object.keys(newdata.todos[0]);
            state.todos = [...state.todos, ...newdata.todos ] //appends to existing list * recommended
        },
        beforemount: (state)=>{
            console.log('before we mount our nodes...')
            state.tablecolumns = ['done', 'id', 'name' ];
        },
        actions: {
            increment: (state) => {
                state.likes += 1;
            },
            decrement: (state) => {
                state.likes -= 1;
            },
            addtodo( state ){ 
                console.log('addtodo')
                state.todo = event.target.value;
                if(!state.todo || (event.key !== 'Enter' && event.type !== 'click')){return;}
                state.todos = [...state.todos, {name: state.todo, done: false, id: state.todos.length}]
                state.todo = ''
            },
            handleMousemove(state, event) {
                const m = {x: event.clientX,y: event.clientY};
                state.mouse = m;
            },
            overRideTodos(state){
                state.todos = [{done: true, id: state.todos.length, name: `foo ${state.todos.length}` }]
            },
            appendTodos(state){
                state.todos = [...state.todos, {done: true, id: state.todos.length, name: `foo ${state.todos.length}`}] //appends to existing list * recommended
            },
            prependTodos(state){
                state.todos = [{name: `foo ${state.todos.length}`, done: true, id: state.todos.length}, ...state.todos] //prepends to existing list
            },
            showMeter(state){
                console.log(event.target)
                state.showMeter = !state.showMeter;
            }
        },
        state: {
            showMeter: false,
            $:{
                xtablecolumns: (state) => Object.keys(state.todos[0]),
                character: (state)=> 'https://raw.githubusercontent.com/msikma/pokesprite/master'+(
                (state.likes > 15) ? '/pokemon-gen8/regular/charizard-gmax.png' : 
                (state.likes > 10) ? '/pokemon-gen8/regular/venusaur-gmax.png' : 
                (state.likes > 5) ? '/pokemon-gen8/shiny/venusaur.png' : 
                (state.likes >= 3)? '/pokemon-gen7x/shiny/venusaur.png':'/items/evo-item/thunder-stone.png')
            },
            likes: 0,
            items: ["one","two","three"],
            todos: [{done: false,id:0, name: "pico"},{done: false,id:1, name: "means very small"}],
            todo: '',
            mouse: {x: 0, y: 0}
        },
        view: document.getElementById('app-template')
        })
        ]);
</script>

</head>

<body>
    <template id="app-templatez">
        <table class="table table-striped table-hover" onmousemove="handleMousemove">
            <thead>
              <tr data-for="key in tablecolumns">
                <th>{key}</th>
              </tr>
            </thead>
            <tbody data-for="thing in todos">
              <tr data-for="col in tablecolumns">
                <td>{thing[col]}</td>
              </tr>
              <!-- <tr >
                <td>{thing.done}</td>
                <td>{loop.index}</td>
                <td>{thing.name}</td>
              </tr> -->
            </tbody>
          </table>
    </template>
    <template id="app-template">
        <style>
            ol{list-style: decimal outside;}
            .red{color: red;}
            .green{color: green;}
            .strike{text-decoration: line-through}
            .todolist{background: aliceblue; padding: 1rem;}
            #app{margin: 0 auto; padding:2rem; max-width: 500px;}
        </style>
        Fun times, improving, exploring, and developing features
        <TestComponent></TestComponent>
        <div class="todolist" onclick="foo">
        <ol class="dyn-list menu" data-for="thing in todos">
            <li class="menu-item">
                <label class="{'form-checkbox'+ (thing.name==='pico' ? ' strike':'')}">
                <label class="form-checkbox'">
                    <input type="checkbox" value="{thing.name}" checked="{thing.name.length>4 ? 'checked':''}">
                    <i class="form-icon"></i> {thing.name}
                </label>
            </li>
            ---{loop.index}
        </ol></div>
        <div class="character">
            <span>x:{state.mouse.x} y: {state.mouse.y}</span>
            <img class="img-responsive col-2" src={state.character} style="margin: 0 auto;"/>
        </div>
        <table class="table table-striped table-hover" onmousemove="handleMousemove">
            <thead>
              <tr data-for="key in tablecolumns">
                <th>{key}</th>
              </tr>
            </thead>
            <tbody data-for="thing in todos">
              <tr data-for="col in tablecolumns">
                <td>{thing[col]}</td>
              </tr>
            </tbody>
        </table>
        <h2 class="{state.todos.length % 2===0 ? 'green': 'red'}">Todos: {state.todos.length}</h2>
        <p>Likes: {state.likes}</p>
        <div class="form-group">
            <label class="form-label">Name</label>
            <input value="{state.todo}" onkeypress="addtodo" class="form-input" type="text" placeholder="Press enter key to submit a todo"/>
            <p><strong>{state.todo} : {state.todo.length}</strong></p>
        </div>
        <div class="btn-group btn-group-block">
            <button onclick="prependTodos" class="btn">Prepend Todos <span>{state.likes}</span></button>
            <button onclick="appendTodos" class="btn">Append Todos <span>{state.likes}</span></button>
            <button onclick="overRideTodos" class="btn">Override todo list <span>{state.likes}</span></button>
        </div>
        <div class="btn-group btn-group-block">
            <button onclick="increment" class="btn btn-primary">+Likes</button>
            <button onclick="showMeter" class="btn btn-primary">Show Meter</button>
            <button onclick="decrement" class="btn btn-primary">-Dislikes</button>
        </div>
    </template>
    <div id="app"><h1>Kunai dojo</h1></div>
</body>

</html>